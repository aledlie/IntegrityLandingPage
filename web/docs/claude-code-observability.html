<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Claude Code Observability Guide | Integrity Studio</title>
    <meta name="description" content="Complete guide to context management, token optimization, and observability for Claude Code using OpenTelemetry and SigNoz.">
    <link rel="canonical" href="https://www.integritystudio.ai/docs/claude-code-observability">

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">

    <style>
        :root {
            --bg-primary: #0a0a0f;
            --bg-secondary: #111118;
            --bg-tertiary: #1a1a24;
            --bg-card: #16161f;
            --border-color: #2a2a3a;
            --text-primary: #f5f5f7;
            --text-secondary: #a1a1aa;
            --text-muted: #71717a;
            --accent-blue: #3b82f6;
            --accent-blue-light: #60a5fa;
            --accent-purple: #8b5cf6;
            --accent-green: #22c55e;
            --accent-yellow: #eab308;
            --accent-red: #ef4444;
            --gradient-start: #3b82f6;
            --gradient-end: #8b5cf6;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.7;
            font-size: 16px;
        }

        /* Navigation */
        .nav {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: rgba(10, 10, 15, 0.95);
            backdrop-filter: blur(12px);
            border-bottom: 1px solid var(--border-color);
            z-index: 100;
            padding: 0 2rem;
        }

        .nav-inner {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
            height: 64px;
        }

        .nav-brand {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            text-decoration: none;
            color: var(--text-primary);
            font-weight: 600;
            font-size: 1.1rem;
        }

        .nav-brand svg {
            width: 28px;
            height: 28px;
            color: var(--accent-blue);
        }

        .nav-links {
            display: flex;
            gap: 2rem;
        }

        .nav-links a {
            color: var(--text-secondary);
            text-decoration: none;
            font-size: 0.9rem;
            transition: color 0.2s;
        }

        .nav-links a:hover {
            color: var(--text-primary);
        }

        /* Layout */
        .layout {
            display: flex;
            margin-top: 64px;
        }

        /* Sidebar */
        .sidebar {
            position: fixed;
            top: 64px;
            left: 0;
            width: 280px;
            height: calc(100vh - 64px);
            background: var(--bg-secondary);
            border-right: 1px solid var(--border-color);
            overflow-y: auto;
            padding: 1.5rem 0;
        }

        .sidebar-section {
            padding: 0 1.5rem;
            margin-bottom: 1.5rem;
        }

        .sidebar-title {
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--text-muted);
            margin-bottom: 0.75rem;
        }

        .sidebar-nav {
            list-style: none;
        }

        .sidebar-nav li {
            margin-bottom: 0.25rem;
        }

        .sidebar-nav a {
            display: block;
            padding: 0.5rem 0.75rem;
            color: var(--text-secondary);
            text-decoration: none;
            font-size: 0.875rem;
            border-radius: 6px;
            transition: all 0.2s;
        }

        .sidebar-nav a:hover,
        .sidebar-nav a.active {
            color: var(--text-primary);
            background: var(--bg-tertiary);
        }

        .sidebar-nav a.active {
            border-left: 2px solid var(--accent-blue);
            padding-left: calc(0.75rem - 2px);
        }

        /* Main Content */
        .main {
            margin-left: 280px;
            flex: 1;
            min-height: calc(100vh - 64px);
        }

        .content {
            max-width: 900px;
            margin: 0 auto;
            padding: 3rem 2rem 6rem;
        }

        /* Hero */
        .hero {
            text-align: center;
            padding: 4rem 2rem;
            background: linear-gradient(180deg, var(--bg-secondary) 0%, var(--bg-primary) 100%);
            border-bottom: 1px solid var(--border-color);
            margin-bottom: 3rem;
        }

        .hero-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.15), rgba(139, 92, 246, 0.15));
            border: 1px solid rgba(59, 130, 246, 0.3);
            padding: 0.5rem 1rem;
            border-radius: 100px;
            font-size: 0.85rem;
            color: var(--accent-blue-light);
            margin-bottom: 1.5rem;
        }

        .hero h1 {
            font-size: 2.75rem;
            font-weight: 700;
            line-height: 1.2;
            margin-bottom: 1rem;
            background: linear-gradient(135deg, var(--text-primary), var(--text-secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .hero p {
            font-size: 1.2rem;
            color: var(--text-secondary);
            max-width: 700px;
            margin: 0 auto 2rem;
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1rem;
            margin: 2rem auto 0;
            max-width: 800px;
        }

        .stat-card {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 1.25rem;
            text-align: center;
        }

        .stat-value {
            font-size: 1.75rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--gradient-start), var(--gradient-end));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .stat-label {
            font-size: 0.8rem;
            color: var(--text-muted);
            margin-top: 0.25rem;
        }

        /* Typography */
        h2 {
            font-size: 1.75rem;
            font-weight: 600;
            margin: 3rem 0 1rem;
            padding-top: 1rem;
            border-top: 1px solid var(--border-color);
        }

        h2:first-of-type {
            margin-top: 0;
            border-top: none;
            padding-top: 0;
        }

        h3 {
            font-size: 1.25rem;
            font-weight: 600;
            margin: 2rem 0 0.75rem;
            color: var(--text-primary);
        }

        h4 {
            font-size: 1rem;
            font-weight: 600;
            margin: 1.5rem 0 0.5rem;
            color: var(--text-secondary);
        }

        p {
            margin-bottom: 1rem;
            color: var(--text-secondary);
        }

        strong {
            color: var(--text-primary);
            font-weight: 600;
        }

        /* Lists */
        ul, ol {
            margin: 0 0 1rem 1.5rem;
            color: var(--text-secondary);
        }

        li {
            margin-bottom: 0.5rem;
        }

        /* Code */
        code {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.875em;
            background: var(--bg-tertiary);
            padding: 0.2em 0.4em;
            border-radius: 4px;
            color: var(--accent-blue-light);
        }

        pre {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 1.25rem;
            overflow-x: auto;
            margin: 1rem 0 1.5rem;
        }

        pre code {
            background: none;
            padding: 0;
            font-size: 0.85rem;
            line-height: 1.6;
            color: var(--text-secondary);
        }

        /* Tables */
        .table-wrapper {
            overflow-x: auto;
            margin: 1rem 0 1.5rem;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9rem;
        }

        th, td {
            text-align: left;
            padding: 0.75rem 1rem;
            border-bottom: 1px solid var(--border-color);
        }

        th {
            background: var(--bg-tertiary);
            font-weight: 600;
            color: var(--text-primary);
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        td {
            color: var(--text-secondary);
        }

        tr:hover td {
            background: rgba(59, 130, 246, 0.05);
        }

        /* Callouts */
        .callout {
            border-radius: 8px;
            padding: 1rem 1.25rem;
            margin: 1.5rem 0;
            border-left: 3px solid;
        }

        .callout-info {
            background: rgba(59, 130, 246, 0.1);
            border-color: var(--accent-blue);
        }

        .callout-success {
            background: rgba(34, 197, 94, 0.1);
            border-color: var(--accent-green);
        }

        .callout-warning {
            background: rgba(234, 179, 8, 0.1);
            border-color: var(--accent-yellow);
        }

        .callout-danger {
            background: rgba(239, 68, 68, 0.1);
            border-color: var(--accent-red);
        }

        .callout-title {
            font-weight: 600;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .callout p:last-child {
            margin-bottom: 0;
        }

        /* Cards */
        .card-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1rem;
            margin: 1.5rem 0;
        }

        .card {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 1.5rem;
            transition: border-color 0.2s, transform 0.2s;
        }

        .card:hover {
            border-color: var(--accent-blue);
            transform: translateY(-2px);
        }

        .card-icon {
            width: 48px;
            height: 48px;
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.2), rgba(139, 92, 246, 0.2));
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 1rem;
            font-size: 1.5rem;
        }

        .card h4 {
            margin: 0 0 0.5rem;
            color: var(--text-primary);
        }

        .card p {
            font-size: 0.9rem;
            margin: 0;
        }

        /* Metric Highlight */
        .metric-highlight {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            background: linear-gradient(135deg, rgba(34, 197, 94, 0.15), rgba(34, 197, 94, 0.05));
            border: 1px solid rgba(34, 197, 94, 0.3);
            padding: 0.25rem 0.75rem;
            border-radius: 6px;
            font-weight: 600;
            color: var(--accent-green);
        }

        /* Architecture Diagram */
        .architecture {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 2rem;
            margin: 1.5rem 0;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85rem;
            line-height: 1.4;
            overflow-x: auto;
            white-space: pre;
            color: var(--text-secondary);
        }

        /* Tab Navigation */
        .tabs {
            display: flex;
            gap: 0;
            border-bottom: 1px solid var(--border-color);
            margin: 2rem 0 1.5rem;
        }

        .tab {
            padding: 0.75rem 1.25rem;
            background: none;
            border: none;
            color: var(--text-muted);
            font-size: 0.9rem;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            margin-bottom: -1px;
            transition: all 0.2s;
        }

        .tab:hover {
            color: var(--text-secondary);
        }

        .tab.active {
            color: var(--accent-blue);
            border-bottom-color: var(--accent-blue);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Progress Bar */
        .progress-bar {
            background: var(--bg-tertiary);
            border-radius: 100px;
            height: 8px;
            overflow: hidden;
            margin: 0.5rem 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--gradient-start), var(--gradient-end));
            border-radius: 100px;
            transition: width 0.3s ease;
        }

        /* Section Anchor */
        .section-anchor {
            scroll-margin-top: 80px;
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .sidebar {
                display: none;
            }
            .main {
                margin-left: 0;
            }
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 640px) {
            .hero h1 {
                font-size: 2rem;
            }
            .hero p {
                font-size: 1rem;
            }
            .stats-grid {
                grid-template-columns: 1fr;
            }
            .content {
                padding: 2rem 1rem;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="nav">
        <div class="nav-inner">
            <a href="/" class="nav-brand">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
                </svg>
                Integrity Studio
            </a>
            <div class="nav-links">
                <a href="/">Home</a>
                <a href="/docs">Docs</a>
                <a href="/blog">Blog</a>
                <a href="/about">About</a>
            </div>
        </div>
    </nav>

    <div class="layout">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-section">
                <div class="sidebar-title">Getting Started</div>
                <ul class="sidebar-nav">
                    <li><a href="#overview" class="active">Overview</a></li>
                    <li><a href="#quick-start">Quick Start</a></li>
                    <li><a href="#architecture">Architecture</a></li>
                </ul>
            </div>

            <div class="sidebar-section">
                <div class="sidebar-title">Context Management</div>
                <ul class="sidebar-nav">
                    <li><a href="#token-optimization">Token Optimization</a></li>
                    <li><a href="#tool-usage">Efficient Tool Usage</a></li>
                    <li><a href="#context-window">Context Window</a></li>
                    <li><a href="#mcp-optimization">MCP Optimization</a></li>
                </ul>
            </div>

            <div class="sidebar-section">
                <div class="sidebar-title">Observability</div>
                <ul class="sidebar-nav">
                    <li><a href="#otel-setup">OpenTelemetry Setup</a></li>
                    <li><a href="#instrumented-hooks">Instrumented Hooks</a></li>
                    <li><a href="#metrics-reference">Metrics Reference</a></li>
                    <li><a href="#dashboards">SigNoz Dashboards</a></li>
                </ul>
            </div>

            <div class="sidebar-section">
                <div class="sidebar-title">Cost Analysis</div>
                <ul class="sidebar-nav">
                    <li><a href="#cost-optimization">Cost Optimization</a></li>
                    <li><a href="#usage-patterns">Usage Patterns</a></li>
                    <li><a href="#recommendations">Recommendations</a></li>
                </ul>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main">
            <!-- Hero -->
            <div class="hero">
                <div class="hero-badge">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12 2L2 7l10 5 10-5-10-5z"/><path d="M2 17l10 5 10-5"/><path d="M2 12l10 5 10-5"/>
                    </svg>
                    Production-Ready Framework
                </div>
                <h1>Claude Code Observability &amp; Context Management</h1>
                <p>Complete guide to token optimization, distributed tracing, and cost efficiency for Claude Code using OpenTelemetry and SigNoz.</p>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value">81%</div>
                        <div class="stat-label">Cost Reduction</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">12</div>
                        <div class="stat-label">Instrumented Hooks</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">8</div>
                        <div class="stat-label">Dashboards</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">85%</div>
                        <div class="stat-label">MCP Token Savings</div>
                    </div>
                </div>
            </div>

            <div class="content">
                <!-- Overview -->
                <section id="overview" class="section-anchor">
                    <h2>Overview</h2>
                    <p>Context management is <strong>"effectively the #1 job"</strong> for engineers building AI agents. As Anthropic emphasizes: <em>"Claude is already smart enough&mdash;intelligence is not the bottleneck, context is."</em></p>

                    <p>This framework provides full visibility into Claude Code operations through:</p>

                    <div class="card-grid">
                        <div class="card">
                            <div class="card-icon">&#128200;</div>
                            <h4>Distributed Tracing</h4>
                            <p>Track operations across hook invocations with OpenTelemetry spans and trace correlation.</p>
                        </div>
                        <div class="card">
                            <div class="card-icon">&#128202;</div>
                            <h4>Metrics Collection</h4>
                            <p>Monitor performance, token usage, and cost patterns with real-time dashboards.</p>
                        </div>
                        <div class="card">
                            <div class="card-icon">&#128209;</div>
                            <h4>Structured Logging</h4>
                            <p>Debug issues with logs correlated to trace context for full observability.</p>
                        </div>
                        <div class="card">
                            <div class="card-icon">&#129302;</div>
                            <h4>LLM Instrumentation</h4>
                            <p>Track token usage, costs, and model performance with Langtrace auto-instrumentation.</p>
                        </div>
                    </div>

                    <div class="callout callout-success">
                        <div class="callout-title">&#9989; Key Results from Optimization</div>
                        <ul>
                            <li><span class="metric-highlight">81%</span> reduction in cost per session</li>
                            <li><span class="metric-highlight">84%</span> reduction in tokens per session</li>
                            <li><span class="metric-highlight">85%</span> reduction in MCP tool overhead</li>
                            <li><span class="metric-highlight">3x</span> more work completed with same daily spend</li>
                        </ul>
                    </div>
                </section>

                <!-- Quick Start -->
                <section id="quick-start" class="section-anchor">
                    <h2>Quick Start</h2>

                    <h3>1. Environment Setup</h3>
                    <p>Add to <code>~/.claude/.envrc</code>:</p>
                    <pre><code># Enable telemetry
export OTEL_ENABLED="true"
export SIGNOZ_ENABLED="true"

# SigNoz Cloud endpoint
export OTEL_EXPORTER_OTLP_ENDPOINT="https://ingest.us.signoz.cloud"
export OTEL_EXPORTER_OTLP_PROTOCOL="http/protobuf"
export OTEL_EXPORTER_OTLP_COMPRESSION="gzip"

# Service identification
export OTEL_SERVICE_NAME="claude-code-hooks"
export OTEL_RESOURCE_ATTRIBUTES="deployment.environment=development"

# Authentication (from Doppler)
export SIGNOZ_INGESTION_KEY="&lt;your-key&gt;"</code></pre>

                    <h3>2. Basic Usage</h3>
                    <pre><code>import {
  initTelemetry, shutdown, withSpan,
  recordMetric, logger, getTraceUrl
} from './lib/otel';

// Initialize at startup
initTelemetry();

// Wrap operations in spans
await withSpan('my-operation', { 'attr.key': 'value' }, async (span) => {
  logger.info('Processing item', { itemId: 123 });
});

// Record custom metrics
recordMetric('items.processed', 42, { queue: 'main' });

// Get trace link for debugging
console.log(`View trace: ${getTraceUrl()}`);

// Clean shutdown
await shutdown();</code></pre>
                </section>

                <!-- Architecture -->
                <section id="architecture" class="section-anchor">
                    <h2>Architecture</h2>
                    <div class="architecture">Claude Code Hooks
        |
        v
  HookMonitor (otel-monitor.ts)
  - Initializes OTel SDK
  - Creates root span
  - Records metrics/logs
        |
        v
+-------------------------------------------+
|         Dual Export Pattern               |
+-------------------------------------------+
|  Local File Export    |   Remote OTLP     |
|  (FileSpanExporter)   |   (SigNoz Cloud)  |
|  JSONL Format         |   TLS + Auth      |
|  ~/.claude/telemetry/ |   ingestion key   |
+-------------------------------------------+
        |                       |
        v                       v
   Local Cache           SigNoz Dashboard
   (JSONL files)         (traces, metrics, logs)</div>

                    <h3>Output Locations</h3>
                    <div class="table-wrapper">
                        <table>
                            <thead>
                                <tr>
                                    <th>Signal</th>
                                    <th>Local File</th>
                                    <th>Remote Endpoint</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Traces</td>
                                    <td><code>telemetry/traces-YYYY-MM-DD.jsonl</code></td>
                                    <td><code>/v1/traces</code></td>
                                </tr>
                                <tr>
                                    <td>Metrics</td>
                                    <td>N/A (remote only)</td>
                                    <td><code>/v1/metrics</code></td>
                                </tr>
                                <tr>
                                    <td>Logs</td>
                                    <td><code>telemetry/logs-YYYY-MM-DD.jsonl</code></td>
                                    <td><code>/v1/logs</code></td>
                                </tr>
                                <tr>
                                    <td>LLM Events</td>
                                    <td><code>telemetry/llm-events-YYYY-MM-DD.jsonl</code></td>
                                    <td>Langtrace spans</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </section>

                <!-- Token Optimization -->
                <section id="token-optimization" class="section-anchor">
                    <h2>Token Optimization Strategies</h2>

                    <h3>Token-Efficient Tool Use</h3>
                    <p>Claude 4 models have <strong>built-in token-efficient tool use</strong> that saves an average of 14% in output tokens (up to 70%) while reducing latency. For Claude Sonnet 3.7, enable:</p>
                    <pre><code>anthropic-beta: token-efficient-tools-2025-02-19</code></pre>

                    <h3>Dynamic/Lazy Context Loading</h3>
                    <p>Instead of loading verbose documentation upfront, use triggers to load detailed context on-demand.</p>

                    <div class="callout callout-info">
                        <div class="callout-title">&#128161; Results from Lazy Loading</div>
                        <ul>
                            <li>Initial context reduced from 7,584 to 3,434 tokens (54% reduction)</li>
                            <li>Monthly cost for 5 developers doing 100 sessions/day: $72 (62% savings)</li>
                        </ul>
                    </div>

                    <h3>Hybrid Model Approach</h3>
                    <div class="table-wrapper">
                        <table>
                            <thead>
                                <tr>
                                    <th>Model</th>
                                    <th>Use For</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><strong>Opus 4.5</strong></td>
                                    <td>High-level planning, architectural design, final code review</td>
                                </tr>
                                <tr>
                                    <td><strong>Sonnet/Haiku</strong></td>
                                    <td>Implementation work, syntax validation, data parsing, quick checks</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </section>

                <!-- Efficient Tool Usage -->
                <section id="tool-usage" class="section-anchor">
                    <h2>Efficient Tool Usage</h2>

                    <h3>When to Use Each Tool</h3>
                    <div class="table-wrapper">
                        <table>
                            <thead>
                                <tr>
                                    <th>Scenario</th>
                                    <th>Recommended Tool</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr><td>Find files by name pattern</td><td><code>Glob</code></td></tr>
                                <tr><td>Search file contents</td><td><code>Grep</code></td></tr>
                                <tr><td>Read known file</td><td><code>Read</code> (with offset/limit for large files)</td></tr>
                                <tr><td>Execute commands</td><td><code>Bash</code> (with output truncation)</td></tr>
                                <tr><td>Open-ended exploration</td><td><code>Task/Subagent</code></td></tr>
                                <tr><td>Verbose operations</td><td>Delegate to subagent</td></tr>
                            </tbody>
                        </table>
                    </div>

                    <h3>Bash Output Limiting</h3>
                    <pre><code># Truncate test output
npm test 2>&1 | tail -30

# Filter for errors/warnings only
npm run build 2>&1 | grep -i "error\|warning" || echo "Build succeeded"

# Limit output to N lines
command | head -100</code></pre>

                    <div class="callout callout-warning">
                        <div class="callout-title">&#9888;&#65039; Memory Warning</div>
                        <p>Claude Code stores all bash output in memory for the entire session. Large outputs (90GB+ reported) can crash the application. Always truncate verbose commands.</p>
                    </div>

                    <h3>Subagent Delegation</h3>
                    <p>Use subagents when:</p>
                    <ul>
                        <li>The task produces verbose output you don't need in your main context</li>
                        <li>You want to enforce specific tool restrictions</li>
                        <li>The work is self-contained and can return a summary</li>
                        <li>Running tests, fetching documentation, or processing log files</li>
                    </ul>
                </section>

                <!-- Context Window Management -->
                <section id="context-window" class="section-anchor">
                    <h2>Context Window Management</h2>

                    <h3>Understanding Context Limits</h3>
                    <div class="table-wrapper">
                        <table>
                            <thead>
                                <tr>
                                    <th>Tier</th>
                                    <th>Context Window</th>
                                    <th>Notes</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr><td>Standard</td><td>200,000 tokens</td><td>Default for most users</td></tr>
                                <tr><td>Advanced (Tier 4+)</td><td>1,000,000 tokens</td><td>Premium pricing applies</td></tr>
                                <tr><td>Premium threshold</td><td>&gt;200K tokens</td><td>2x input, 1.5x output pricing</td></tr>
                            </tbody>
                        </table>
                    </div>

                    <div class="callout callout-danger">
                        <div class="callout-title">&#128308; Critical Insight</div>
                        <p>Avoid using the final 20% of your context window for complex tasks. Quality notably declines for memory-intensive operations.</p>
                    </div>

                    <h3>Built-in Commands</h3>
                    <div class="table-wrapper">
                        <table>
                            <thead>
                                <tr>
                                    <th>Command</th>
                                    <th>Purpose</th>
                                    <th>When to Use</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr><td><code>/context</code></td><td>Visualizes context usage</td><td>Before deciding to compact</td></tr>
                                <tr><td><code>/clear</code></td><td>Wipes conversation history</td><td>Between tasks; when &lt;50% context is relevant</td></tr>
                                <tr><td><code>/compact</code></td><td>Summarizes conversation</td><td>At 70% capacity; at logical breakpoints</td></tr>
                                <tr><td><code>/cost</code></td><td>Shows token usage stats</td><td>To understand patterns</td></tr>
                            </tbody>
                        </table>
                    </div>

                    <h3>Context Tracking Visualization</h3>
                    <pre><code>&#128202; Context: 45K tokens (22.5%)
   [&#9608;&#9608;&#9608;&#9608;&#9617;&#9617;&#9617;&#9617;&#9617;&#9617;&#9617;&#9617;&#9617;&#9617;&#9617;&#9617;&#9617;&#9617;&#9617;&#9617;] &#128994;  (green &lt; 50%)
   [&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9617;&#9617;&#9617;&#9617;&#9617;&#9617;&#9617;&#9617;&#9617;&#9617;] &#128993;  (yellow 50-70%)
   [&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9617;&#9617;&#9617;&#9617;&#9617;&#9617;] &#128308;  (red &gt; 70%)</code></pre>
                </section>

                <!-- MCP Optimization -->
                <section id="mcp-optimization" class="section-anchor">
                    <h2>MCP Server Optimization</h2>

                    <h3>The Problem</h3>
                    <p>MCP tool definitions can consume massive context:</p>
                    <ul>
                        <li>5-server setup: ~55K tokens before conversation starts</li>
                        <li>Jira alone: ~17K tokens</li>
                        <li>One reported case: 134K tokens of tool definitions</li>
                    </ul>

                    <h3>MCP Tool Search</h3>
                    <p>Reduces token overhead by <strong>85%</strong> by loading tools on-demand rather than upfront.</p>
                    <pre><code># Auto mode (default) - activates when tools exceed threshold
ENABLE_TOOL_SEARCH=auto

# Custom threshold (5%)
ENABLE_TOOL_SEARCH=auto:5

# Disable entirely
ENABLE_TOOL_SEARCH=false</code></pre>

                    <div class="callout callout-success">
                        <div class="callout-title">&#128200; Performance Improvements</div>
                        <ul>
                            <li>Opus 4: 49% to 74% accuracy</li>
                            <li>Opus 4.5: 79.5% to 88.1% accuracy</li>
                            <li>46.9% reduction in total agent tokens (51K to 8.5K)</li>
                        </ul>
                    </div>

                    <h3>Manual Optimization</h3>
                    <ol>
                        <li>Use <code>/context</code> to identify consumption</li>
                        <li>Disable unused servers with <code>@server-name disable</code> or <code>/mcp</code></li>
                        <li>Re-enable only when needed</li>
                    </ol>
                </section>

                <!-- OpenTelemetry Setup -->
                <section id="otel-setup" class="section-anchor">
                    <h2>OpenTelemetry Setup</h2>

                    <h3>Core Components</h3>
                    <div class="table-wrapper">
                        <table>
                            <thead>
                                <tr>
                                    <th>Component</th>
                                    <th>File</th>
                                    <th>Purpose</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr><td>OTel Core</td><td><code>hooks/lib/otel.ts</code></td><td>SDK initialization, tracing, metrics, logging</td></tr>
                                <tr><td>Hook Monitor</td><td><code>hooks/lib/otel-monitor.ts</code></td><td>Simplified hook instrumentation</td></tr>
                                <tr><td>Langtrace</td><td><code>hooks/lib/langtrace.ts</code></td><td>Auto-instrument LLM API calls</td></tr>
                                <tr><td>Token Metrics</td><td><code>hooks/lib/token-metrics.ts</code></td><td>Cost and token tracking</td></tr>
                            </tbody>
                        </table>
                    </div>

                    <h3>Key Functions</h3>
                    <div class="table-wrapper">
                        <table>
                            <thead>
                                <tr>
                                    <th>Function</th>
                                    <th>Purpose</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr><td><code>initTelemetry()</code></td><td>Initialize SDK with exporters</td></tr>
                                <tr><td><code>withSpan(name, attrs, fn)</code></td><td>Wrap async function in a span</td></tr>
                                <tr><td><code>recordMetric(name, value, attrs)</code></td><td>Record counter metric</td></tr>
                                <tr><td><code>recordGauge(name, value, attrs)</code></td><td>Record gauge metric</td></tr>
                                <tr><td><code>logger.info/warn/error()</code></td><td>Structured logging</td></tr>
                                <tr><td><code>getTraceUrl()</code></td><td>Get SigNoz trace link</td></tr>
                                <tr><td><code>shutdown()</code></td><td>Graceful cleanup</td></tr>
                            </tbody>
                        </table>
                    </div>

                    <h3>Langtrace PII Redaction</h3>
                    <p>Auto-redacted patterns for sensitive data protection:</p>
                    <div class="table-wrapper">
                        <table>
                            <thead>
                                <tr>
                                    <th>Pattern</th>
                                    <th>Replacement</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr><td>Email addresses</td><td><code>[EMAIL]</code></td></tr>
                                <tr><td>Phone numbers</td><td><code>[PHONE]</code></td></tr>
                                <tr><td>SSN</td><td><code>[SSN]</code></td></tr>
                                <tr><td>Credit card numbers</td><td><code>[CREDIT_CARD]</code></td></tr>
                                <tr><td>API keys</td><td><code>[API_KEY]</code></td></tr>
                                <tr><td>AWS access keys</td><td><code>[AWS_KEY]</code></td></tr>
                                <tr><td>JWT tokens</td><td><code>[JWT_TOKEN]</code></td></tr>
                            </tbody>
                        </table>
                    </div>
                </section>

                <!-- Instrumented Hooks -->
                <section id="instrumented-hooks" class="section-anchor">
                    <h2>Instrumented Hooks</h2>
                    <div class="table-wrapper">
                        <table>
                            <thead>
                                <tr>
                                    <th>Hook</th>
                                    <th>Event</th>
                                    <th>Description</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr><td><code>session-start-otel.ts</code></td><td>SessionStart</td><td>Session initialization</td></tr>
                                <tr><td><code>mcp-pre-tool-otel.ts</code></td><td>PreToolUse</td><td>MCP tool invocation start</td></tr>
                                <tr><td><code>mcp-post-tool-otel.ts</code></td><td>PostToolUse</td><td>MCP tool completion</td></tr>
                                <tr><td><code>agent-pre-tool-otel.ts</code></td><td>PreToolUse</td><td>Subagent spawn</td></tr>
                                <tr><td><code>agent-post-tool-otel.ts</code></td><td>PostToolUse</td><td>Subagent completion</td></tr>
                                <tr><td><code>skill-activation-prompt-otel.ts</code></td><td>UserPromptSubmit</td><td>Skill detection</td></tr>
                                <tr><td><code>tsc-check-otel.ts</code></td><td>PostToolUse</td><td>TypeScript checks</td></tr>
                                <tr><td><code>stop-build-check-otel.ts</code></td><td>Stop</td><td>Build verification</td></tr>
                            </tbody>
                        </table>
                    </div>
                </section>

                <!-- Metrics Reference -->
                <section id="metrics-reference" class="section-anchor">
                    <h2>Metrics Reference</h2>

                    <h3>Hook Metrics</h3>
                    <div class="table-wrapper">
                        <table>
                            <thead>
                                <tr>
                                    <th>Metric</th>
                                    <th>Type</th>
                                    <th>Description</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr><td><code>hook.duration</code></td><td>Histogram</td><td>Execution time distribution</td></tr>
                                <tr><td><code>hook.executions</code></td><td>Counter</td><td>Total invocations</td></tr>
                                <tr><td><code>mcp.invocations</code></td><td>Counter</td><td>MCP tool calls</td></tr>
                                <tr><td><code>agent.invocations</code></td><td>Counter</td><td>Subagent spawns</td></tr>
                            </tbody>
                        </table>
                    </div>

                    <h3>GenAI Metrics</h3>
                    <div class="table-wrapper">
                        <table>
                            <thead>
                                <tr>
                                    <th>Metric</th>
                                    <th>Type</th>
                                    <th>Description</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr><td><code>gen_ai.client.token.usage</code></td><td>Counter</td><td>Tokens consumed</td></tr>
                                <tr><td><code>gen_ai.client.cost</code></td><td>Counter</td><td>Cost in USD</td></tr>
                                <tr><td><code>gen_ai.client.operation.duration</code></td><td>Histogram</td><td>LLM call latency</td></tr>
                            </tbody>
                        </table>
                    </div>

                    <h3>Context Metrics</h3>
                    <div class="table-wrapper">
                        <table>
                            <thead>
                                <tr>
                                    <th>Metric</th>
                                    <th>Description</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr><td><code>session.context.size</code></td><td>Tokens at session start</td></tr>
                                <tr><td><code>session.context.utilization</code></td><td>% of 200K window used</td></tr>
                                <tr><td><code>session.starts</code></td><td>Session start counter</td></tr>
                            </tbody>
                        </table>
                    </div>
                </section>

                <!-- SigNoz Dashboards -->
                <section id="dashboards" class="section-anchor">
                    <h2>SigNoz Dashboards</h2>
                    <div class="table-wrapper">
                        <table>
                            <thead>
                                <tr>
                                    <th>Dashboard</th>
                                    <th>Purpose</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr><td>Claude Code Hooks Observability</td><td>Core hook performance</td></tr>
                                <tr><td>Claude Code Hooks Performance</td><td>Duration and status distribution</td></tr>
                                <tr><td>Token Usage &amp; Cost Efficiency</td><td>LLM consumption and costs</td></tr>
                                <tr><td>Tool &amp; MCP Usage Analytics</td><td>MCP server/tool usage</td></tr>
                                <tr><td>Error &amp; Anomaly Detection</td><td>Error monitoring</td></tr>
                                <tr><td>Build &amp; Type Check Performance</td><td>TSC/Python metrics</td></tr>
                                <tr><td>Subagent Analytics</td><td>Agent invocations</td></tr>
                                <tr><td>Session Health Overview</td><td>Session activity</td></tr>
                            </tbody>
                        </table>
                    </div>
                </section>

                <!-- Cost Optimization -->
                <section id="cost-optimization" class="section-anchor">
                    <h2>Cost Optimization</h2>

                    <h3>Session Strategy Comparison</h3>
                    <div class="table-wrapper">
                        <table>
                            <thead>
                                <tr>
                                    <th>Metric</th>
                                    <th>Before (Dec)</th>
                                    <th>After (Jan W3)</th>
                                    <th>Change</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr><td>Avg Sessions/Day</td><td>7.3</td><td>26.2</td><td class="metric-highlight">+259%</td></tr>
                                <tr><td>Tokens/Session</td><td>40,246</td><td>6,503</td><td class="metric-highlight">-84%</td></tr>
                                <tr><td>Cost/Session</td><td>$22.17</td><td>$3.64</td><td class="metric-highlight">-84%</td></tr>
                                <tr><td>Cost/Message</td><td>$0.067</td><td>$0.021</td><td class="metric-highlight">-69%</td></tr>
                            </tbody>
                        </table>
                    </div>

                    <div class="callout callout-info">
                        <div class="callout-title">&#128161; The Pattern</div>
                        <p><strong>December:</strong> Fewer, longer sessions (avg 40K tokens each) &rarr; Context grows large &rarr; expensive</p>
                        <p><strong>January:</strong> More, shorter sessions (avg 6.5K tokens each) &rarr; Context stays small &rarr; efficient</p>
                    </div>

                    <h3>Cost by Category</h3>
                    <div class="table-wrapper">
                        <table>
                            <thead>
                                <tr>
                                    <th>Category</th>
                                    <th>Cost</th>
                                    <th>% of Total</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr><td>Cache Read</td><td>$1,916.70</td><td>52.2%</td></tr>
                                <tr><td>Cache Write</td><td>$1,649.57</td><td>44.9%</td></tr>
                                <tr><td>Output</td><td>$94.16</td><td>2.6%</td></tr>
                                <tr><td>Input</td><td>$13.94</td><td>0.4%</td></tr>
                            </tbody>
                        </table>
                    </div>

                    <p><strong>Key insight:</strong> Cache operations = 97% of cost. Without caching, input would cost ~$19,600 (5.3x more expensive).</p>
                </section>

                <!-- Usage Patterns -->
                <section id="usage-patterns" class="section-anchor">
                    <h2>Usage Patterns</h2>

                    <h3>Research vs Implementation</h3>
                    <div class="table-wrapper">
                        <table>
                            <thead>
                                <tr>
                                    <th>Activity</th>
                                    <th>Tokens/Message</th>
                                    <th>Cost Efficiency</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr><td>Research</td><td>100-150</td><td>Low</td></tr>
                                <tr><td>Implementation</td><td>4-5</td><td><strong>High</strong></td></tr>
                            </tbody>
                        </table>
                    </div>

                    <h3>Spike Day Analysis</h3>
                    <div class="table-wrapper">
                        <table>
                            <thead>
                                <tr>
                                    <th>Day</th>
                                    <th>Type</th>
                                    <th>Sessions</th>
                                    <th>Tokens</th>
                                    <th>Tokens/Session</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr><td>Dec 14</td><td>Research</td><td>27</td><td>1.08M</td><td>39,922</td></tr>
                                <tr><td>Jan 11</td><td>Research</td><td>22</td><td>1.38M</td><td>62,533</td></tr>
                                <tr><td>Jan 17</td><td>Implementation</td><td>16</td><td>104K</td><td>6,517</td></tr>
                                <tr><td>Jan 19</td><td>Rapid iteration</td><td>83</td><td>499K</td><td>6,008</td></tr>
                            </tbody>
                        </table>
                    </div>
                </section>

                <!-- Recommendations -->
                <section id="recommendations" class="section-anchor">
                    <h2>Recommendations</h2>

                    <h3>Maintain the Gains</h3>
                    <ol>
                        <li><strong>Keep sessions short</strong> &mdash; Target &lt;10K tokens/session</li>
                        <li><strong>Reset frequently</strong> &mdash; New session after major task completion</li>
                        <li><strong>Compact at 70%</strong> &mdash; Don't let context hit limits</li>
                        <li><strong>Monitor trends</strong> &mdash; Watch <code>session.context.utilization</code> in SigNoz</li>
                    </ol>

                    <h3>Optimize Further</h3>
                    <ol>
                        <li><strong>Batch research</strong> &mdash; Dedicate specific sessions to exploration</li>
                        <li><strong>Use subagents</strong> &mdash; Delegate verbose operations</li>
                        <li><strong>Truncate output</strong> &mdash; <code>| tail -30</code> for logs, use offset/limit for files</li>
                    </ol>

                    <h3>Daily Workflow</h3>
                    <pre><code>1. Start session
   - /context to check baseline
   - Disable unused MCP servers

2. During work
   - Use subagents for verbose operations
   - Truncate bash output
   - Read files with offset/limit for large files
   - Use Grep output_mode: "files_with_matches"

3. Between tasks
   - /clear if &lt;50% context is relevant
   - /compact at 70% capacity

4. End of session
   - Document progress in .md file
   - /cost to review usage</code></pre>

                    <h3>Config Cleanup Impact</h3>
                    <div class="table-wrapper">
                        <table>
                            <thead>
                                <tr>
                                    <th>File</th>
                                    <th>Before</th>
                                    <th>After</th>
                                    <th>Reduction</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr><td>settings.local.json</td><td>1.8 KB</td><td>303 bytes</td><td>83%</td></tr>
                                <tr><td>settings.json</td><td>2.8 KB</td><td>2.2 KB</td><td>21%</td></tr>
                                <tr><td>skill-rules.json</td><td>14.4 KB</td><td>13.8 KB</td><td>4%</td></tr>
                                <tr><td>marketplaces.json</td><td>3.6 KB</td><td>2.8 KB</td><td>23%</td></tr>
                            </tbody>
                        </table>
                    </div>
                </section>

                <!-- Footer -->
                <footer style="margin-top: 4rem; padding-top: 2rem; border-top: 1px solid var(--border-color); text-align: center; color: var(--text-muted); font-size: 0.875rem;">
                    <p>Built with <a href="https://opentelemetry.io" style="color: var(--accent-blue);">OpenTelemetry</a> and <a href="https://signoz.io" style="color: var(--accent-blue);">SigNoz</a></p>
                    <p style="margin-top: 0.5rem;">&copy; 2026 Integrity Studio. All rights reserved.</p>
                </footer>
            </div>
        </main>
    </div>

    <script>
        // Sidebar active state on scroll
        const sections = document.querySelectorAll('.section-anchor');
        const navLinks = document.querySelectorAll('.sidebar-nav a');

        const observerOptions = {
            root: null,
            rootMargin: '-20% 0px -80% 0px',
            threshold: 0
        };

        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    navLinks.forEach(link => {
                        link.classList.remove('active');
                        if (link.getAttribute('href') === '#' + entry.target.id) {
                            link.classList.add('active');
                        }
                    });
                }
            });
        }, observerOptions);

        sections.forEach(section => observer.observe(section));
    </script>
</body>
</html>
